import{_ as W}from"../chunks/preload-helper-9b84080b.js";import{S as M,i as q,s as B,l as y,f as p,J as V,K as L,a as k,d as _,b as d,L as Z,M as R,e as N,c as S,H as b,I as j,N as $,k as G,O as x,n as X,u as P,w as ee,x as A,A as te,r as ne,t as O,g as D,h as re,P as se,j as oe,m as le,o as ie,v as ae}from"../chunks/vendor-3196babf.js";const g=1,ce=Array.from({length:6},(l,t)=>`${g*Math.cos(t/6*6.2868)} ${g*Math.sin(t/6*6.2868)}`).join(", ");function Y(l){const t=["gray","#ee3333","#7777ff"];return l>=t.length?"pink":t[l]}function v([l,t],[n,e]){return[l*2*g*Math.cos(3.1415/6),t*2*g+(n-l)*g]}function C(l,t=0){return Array.from({length:l},(n,e)=>Array.from({length:l},(o,s)=>t))}function F(l,t,n){const e=l.slice();return e[5]=t[n],e[7]=n,e}function H(l,t,n){const e=l.slice();return e[8]=t[n],e[10]=n,e}function K(l){let t,n,e,o,s;return{c(){t=V("polygon"),this.h()},l(r){t=L(r,"polygon",{points:!0,"stroke-width":!0,fill:!0,transform:!0}),k(t).forEach(_),this.h()},h(){d(t,"points",ce),d(t,"stroke-width","0"),d(t,"fill",n=Y(l[8])),d(t,"transform",e=`translate(${v([l[10],l[7]],[l[2]-1,l[1]-1]).join(", ")}) scale(1.05)`)},m(r,a){p(r,t,a),o||(s=Z(t,"click",l[3](l[10],l[7])),o=!0)},p(r,a){l=r,a&1&&n!==(n=Y(l[8]))&&d(t,"fill",n),a&6&&e!==(e=`translate(${v([l[10],l[7]],[l[2]-1,l[1]-1]).join(", ")}) scale(1.05)`)&&d(t,"transform",e)},d(r){r&&_(t),o=!1,s()}}}function T(l){let t,n=l[5],e=[];for(let o=0;o<n.length;o+=1)e[o]=K(H(l,n,o));return{c(){for(let o=0;o<e.length;o+=1)e[o].c();t=y()},l(o){for(let s=0;s<e.length;s+=1)e[s].l(o);t=y()},m(o,s){for(let r=0;r<e.length;r+=1)e[r].m(o,s);p(o,t,s)},p(o,s){if(s&15){n=o[5];let r;for(r=0;r<n.length;r+=1){const a=H(o,n,r);e[r]?e[r].p(a,s):(e[r]=K(a),e[r].c(),e[r].m(t.parentNode,t))}for(;r<e.length;r+=1)e[r].d(1);e.length=n.length}},d(o){R(e,o),o&&_(t)}}}function fe(l){let t,n,e,o=l[0],s=[];for(let r=0;r<o.length;r+=1)s[r]=T(F(l,o,r));return{c(){t=N("div"),n=V("svg");for(let r=0;r<s.length;r+=1)s[r].c();this.h()},l(r){t=S(r,"DIV",{class:!0});var a=k(t);n=L(a,"svg",{viewBox:!0,class:!0});var i=k(n);for(let f=0;f<s.length;f+=1)s[f].l(i);i.forEach(_),a.forEach(_),this.h()},h(){d(n,"viewBox",e=`-${g*1.5} -${g*1.2} ${v([l[2]+.7,0],[l[2]-1,l[1]-1])[0]} ${v([0,l[1]+.2],[l[2]-1,l[1]-1])[1]}`),d(n,"class","svelte-odj2v2"),d(t,"class","svelte-odj2v2")},m(r,a){p(r,t,a),b(t,n);for(let i=0;i<s.length;i+=1)s[i].m(n,null)},p(r,[a]){if(a&15){o=r[0];let i;for(i=0;i<o.length;i+=1){const f=F(r,o,i);s[i]?s[i].p(f,a):(s[i]=T(f),s[i].c(),s[i].m(n,null))}for(;i<s.length;i+=1)s[i].d(1);s.length=o.length}a&6&&e!==(e=`-${g*1.5} -${g*1.2} ${v([r[2]+.7,0],[r[2]-1,r[1]-1])[0]} ${v([0,r[1]+.2],[r[2]-1,r[1]-1])[1]}`)&&d(n,"viewBox",e)},i:j,o:j,d(r){r&&_(t),R(s,r)}}}function _e(l,t,n){let e,o;const s=$();let{grid:r=C(9)}=t;const a=(i,f)=>h=>s("click",{cellX:i,cellY:f});return l.$$set=i=>{"grid"in i&&n(0,r=i.grid)},l.$$.update=()=>{l.$$.dirty&1&&n(2,e=r[0].length),l.$$.dirty&1&&n(1,o=r.length)},[r,o,e,a]}class ue extends M{constructor(t){super();q(this,t,_e,fe,B,{grid:0})}}class U{constructor(t){this.id=t,this.solve=null}async get_move(){return new Promise(t=>{this.solve=([n,e])=>{this.solve=null,t([n,e])}})}on(t){if(t=="gridclick")return({detail:{cellX:n,cellY:e,peer_id:o}})=>{this.id==o&&(!this.solve||this.solve([n,e]))}}}class he{constructor(t){this.grid=C(t),this.players=[new U,new U],this.current_player_i=0}sync_json(t){this.grid=t.grid,this.current_player_i=t.current_player_i}to_json(){return{grid:this.grid,current_player_i:this.current_player_i}}next_player(){this.current_player_i=(this.current_player_i+1)%this.players.length}get current_player(){return this.players[this.current_player_i]}move([t,n],e){try{return this.grid[n][t]==0?(this.grid[n][t]=e,!0):!1}catch(o){return!1}}winner(){return 0}}function de(l){let t,n,e,o,s=l[3]&&z(l);return{c(){t=N("div"),n=O("waiting for the other player..."),e=G(),s&&s.c(),o=y()},l(r){t=S(r,"DIV",{});var a=k(t);n=D(a,"waiting for the other player..."),a.forEach(_),e=X(r),s&&s.l(r),o=y()},m(r,a){p(r,t,a),b(t,n),p(r,e,a),s&&s.m(r,a),p(r,o,a)},p(r,a){r[3]?s?s.p(r,a):(s=z(r),s.c(),s.m(o.parentNode,o)):s&&(s.d(1),s=null)},i:j,o:j,d(r){r&&_(t),r&&_(e),s&&s.d(r),r&&_(o)}}}function pe(l){let t,n;return t=new ue({props:{grid:l[0].grid}}),t.$on("click",function(){se(l[1])&&l[1].apply(this,arguments)}),{c(){oe(t.$$.fragment)},l(e){le(t.$$.fragment,e)},m(e,o){ie(t,e,o),n=!0},p(e,o){l=e;const s={};o&1&&(s.grid=l[0].grid),t.$set(s)},i(e){n||(A(t.$$.fragment,e),n=!0)},o(e){P(t.$$.fragment,e),n=!1},d(e){ae(t,e)}}}function z(l){let t,n,e;return{c(){t=N("div"),n=O("invitation link: "),e=O(l[3])},l(o){t=S(o,"DIV",{});var s=k(t);n=D(s,"invitation link: "),e=D(s,l[3]),s.forEach(_)},m(o,s){p(o,t,s),b(t,n),b(t,e)},p(o,s){s&8&&re(e,o[3])},d(o){o&&_(t)}}}function ge(l){let t,n,e,o,s;const r=[pe,de],a=[];function i(f,h){return f[2]?0:1}return n=i(l),e=a[n]=r[n](l),{c(){t=G(),e.c(),o=y(),this.h()},l(f){x('[data-svelte="svelte-kq5fpw"]',document.head).forEach(_),t=X(f),e.l(f),o=y(),this.h()},h(){document.title="hex"},m(f,h){p(f,t,h),a[n].m(f,h),p(f,o,h),s=!0},p(f,[h]){let m=n;n=i(f),n===m?a[n].p(f,h):(ne(),P(a[m],1,1,()=>{a[m]=null}),ee(),e=a[n],e?e.p(f,h):(e=a[n]=r[n](f),e.c()),A(e,1),e.m(o.parentNode,o))},i(f){s||(A(e),s=!0)},o(f){P(e),s=!1},d(f){f&&_(t),a[n].d(f),f&&_(o)}}}function me(l,t,n){let e=new he(11),o=()=>{},s=!1,r="";return te(async()=>{const a=(await W(()=>import("../chunks/peerjs.min-ad03fae9.js").then(function(c){return c.p}),[])).default,i=new a,f=c=>{const u=JSON.stringify(c);for(let Q in i.connections)i.connections[Q].forEach(J=>{J&&J.send(u)})},h=e.players.map(c=>c.on("gridclick")),m=c=>{h.forEach(u=>u(c))};n(1,o=c=>{c.detail.peer_id=i.id,f({event:"gridclick",args:{detail:c.detail}}),m(c)});const w=new URLSearchParams(window.location.search).get("session"),E=c=>{const u=JSON.parse(c);u.event=="gridclick"?m(u.args):u.event=="statesync"&&(console.log("syncing state..."),e.sync_json(u.data),n(0,e))};w?(i.on("open",()=>{e.players.forEach(u=>u.id=i.id),n(0,e.players[0].id=w,e),n(3,r=window.location.origin+window.location.pathname+"?session="+i.id),console.log("connecting to peer "+w);let c=i.connect(w);c.on("data",E),c.on("open",()=>n(2,s=!0)),c.on("close",()=>n(2,s=!1))}),i.on("connection",c=>{n(0,e.players[0].id=c.peer,e),c.on("data",E),c.on("open",()=>{n(2,s=!0),console.log("sending sync data..."),c.send(JSON.stringify({event:"statesync",data:e.to_json()}))}),c.on("close",()=>n(2,s=!1))})):(i.on("open",()=>{e.players.forEach(c=>c.id=i.id),n(3,r=window.location.origin+window.location.pathname+"?session="+i.id)}),i.on("connection",c=>{n(0,e.players[1].id=c.peer,e),c.on("data",E),c.on("open",()=>{n(2,s=!0),console.log("sending sync data..."),c.send(JSON.stringify({event:"statesync",data:e.to_json()}))}),c.on("close",()=>n(2,s=!1))}));const I=async()=>{const c=e.current_player;if(e.winner())return;let u=null;do u=await c.get_move();while(!e.move(u,e.current_player_i+1));n(0,e),e.next_player(),requestAnimationFrame(I)};I()}),[e,o,s,r]}class we extends M{constructor(t){super();q(this,t,me,ge,B,{})}}export{we as default};
